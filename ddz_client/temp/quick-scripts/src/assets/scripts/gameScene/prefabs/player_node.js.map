{"version":3,"sources":["assets/scripts/gameScene/prefabs/player_node.js"],"names":["cc","Class","Component","properties","account_label","Label","nickname_label","room_touxiang","Sprite","globalcount_label","headimage","readyimage","Node","offlineimage","card_node","card_prefab","Prefab","clockimage","qiangdidzhu_node","time_label","robimage_sp","SpriteFrame","robnoimage_sp","robIconSp","robIcon_Sp","robnoIcon_Sp","masterIcon","onLoad","active","node","on","event","bind","console","log","accountid","myglobal","playerData","accountID","pushCard","detail","state","qian_state","qian","buqiang","start","init_data","data","index","JSON","stringify","string","nick_name","goldcount","cardlist_node","seat_index","isready","str","avatarUrl","head_image_path","loader","loadRes","err","spriteFrame","message","x","i","card","instantiate","scale","parent","name","height","y","push"],"mappings":";;;;;;AAAA;;;;AAEAA,EAAE,CAACC,KAAH,CAAS;EACL,WAASD,EAAE,CAACE,SADP;EAGLC,UAAU,EAAE;IACRC,aAAa,EAACJ,EAAE,CAACK,KADT;IAERC,cAAc,EAACN,EAAE,CAACK,KAFV;IAGRE,aAAa,EAACP,EAAE,CAACQ,MAHT;IAIRC,iBAAiB,EAACT,EAAE,CAACK,KAJb;IAKRK,SAAS,EAACV,EAAE,CAACQ,MALL;IAMRG,UAAU,EAACX,EAAE,CAACY,IANN;IAORC,YAAY,EAACb,EAAE,CAACY,IAPR;IAQRE,SAAS,EAACd,EAAE,CAACY,IARL;IASRG,WAAW,EAACf,EAAE,CAACgB,MATP;IAUR;IACAC,UAAU,EAACjB,EAAE,CAACY,IAXN;IAYRM,gBAAgB,EAAClB,EAAE,CAACY,IAZZ;IAYkB;IAC1BO,UAAU,EAACnB,EAAE,CAACK,KAbN;IAcRe,WAAW,EAACpB,EAAE,CAACqB,WAdP;IAeRC,aAAa,EAACtB,EAAE,CAACqB,WAfT;IAgBRE,SAAS,EAAEvB,EAAE,CAACQ,MAhBN;IAiBRgB,UAAU,EAACxB,EAAE,CAACY,IAjBN;IAkBRa,YAAY,EAACzB,EAAE,CAACY,IAlBR;IAmBRc,UAAU,EAAC1B,EAAE,CAACY;EAnBN,CAHP;EAyBL;EAEAe,MA3BK,oBA2BK;IACR,KAAKhB,UAAL,CAAgBiB,MAAhB,GAAyB,KAAzB;IACA,KAAKf,YAAL,CAAkBe,MAAlB,GAA2B,KAA3B,CAFQ,CAIR;;IACA,KAAKC,IAAL,CAAUC,EAAV,CAAa,iBAAb,EAA+B,UAASC,KAAT,EAAe;MAC5C,KAAKpB,UAAL,CAAgBiB,MAAhB,GAAyB,KAAzB;IACD,CAF8B,CAE7BI,IAF6B,CAExB,IAFwB,CAA/B,EALQ,CASR;;IACA,KAAKH,IAAL,CAAUC,EAAV,CAAa,iBAAb,EAA+B,UAASC,KAAT,EAAe;MAC5CE,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAD4C,CAE5C;;MACA,IAAG,KAAKC,SAAL,IAAgBC,oBAAA,CAASC,UAAT,CAAoBC,SAAvC,EAAiD;QAC7C;MACH;;MACD,KAAKC,QAAL;IACD,CAP8B,CAO7BP,IAP6B,CAOxB,IAPwB,CAA/B;IASA,KAAKH,IAAL,CAAUC,EAAV,CAAa,4BAAb,EAA0C,UAASC,KAAT,EAAe;MACrD;MACA,IAAIS,MAAM,GAAGT,KAAb,CAFqD,CAIrD;MACA;;MACA,IAAGS,MAAM,CAACL,SAAP,IAAkB,KAAKA,SAA1B,EAAoC;QAClC;QACA,KAAKjB,gBAAL,CAAsBU,MAAtB,GAA+B,KAA/B;MAED;;MAED,IAAG,KAAKO,SAAL,IAAkBK,MAAM,CAACL,SAA5B,EAAsC;QACpC,IAAGK,MAAM,CAACC,KAAP,IAAcC,UAAU,CAACC,IAA5B,EAAiC;UAE/BV,OAAO,CAACC,GAAR,CAAY,+BAAZ;UACA,KAAKV,UAAL,CAAgBI,MAAhB,GAAyB,IAAzB;QAED,CALD,MAKM,IAAGY,MAAM,CAACC,KAAP,IAAcC,UAAU,CAACE,OAA5B,EAAoC;UACxC,KAAKnB,YAAL,CAAkBG,MAAlB,GAA2B,IAA3B;QAED,CAHK,MAGD;UACHK,OAAO,CAACC,GAAR,CAAY,oBAAkBM,MAAM,CAACC,KAArC;QACD;MACF;IAEJ,CA1ByC,CA0BxCT,IA1BwC,CA0BnC,IA1BmC,CAA1C;IA4BA,KAAKH,IAAL,CAAUC,EAAV,CAAa,+BAAb,EAA6C,UAASC,KAAT,EAAe;MACzD,IAAIS,MAAM,GAAGT,KAAb;MACA,KAAKP,UAAL,CAAgBI,MAAhB,GAAyB,KAAzB;MACA,KAAKH,YAAL,CAAkBG,MAAlB,GAA2B,KAA3B;;MACA,IAAGY,MAAM,IAAE,KAAKL,SAAhB,EAA0B;QACvB,KAAKT,UAAL,CAAgBE,MAAhB,GAAyB,IAAzB;MACD;IACJ,CAP4C,CAO3CI,IAP2C,CAOtC,IAPsC,CAA7C,EA/CQ,CAwDR;IACA;IACA;IACA;IAEA;IACA;EACD,CA1FI;EA4FLa,KA5FK,mBA4FI,CAER,CA9FI;EAgGL;EACA;EACA;EACAC,SAnGK,qBAmGKC,IAnGL,EAmGUC,KAnGV,EAmGgB;IACnBf,OAAO,CAACC,GAAR,CAAY,eAAae,IAAI,CAACC,SAAL,CAAeH,IAAf,CAAzB,EADmB,CAEnB;;IACA,KAAKZ,SAAL,GAAiBY,IAAI,CAACZ,SAAtB;IACA,KAAK/B,aAAL,CAAmB+C,MAAnB,GAA4BJ,IAAI,CAACZ,SAAjC;IACA,KAAK7B,cAAL,CAAoB6C,MAApB,GAA6BJ,IAAI,CAACK,SAAlC;IACA,KAAK3C,iBAAL,CAAuB0C,MAAvB,GAAgCJ,IAAI,CAACM,SAArC;IACA,KAAKC,aAAL,GAAqB,EAArB;IACA,KAAKC,UAAL,GAAkBP,KAAlB;;IACA,IAAGD,IAAI,CAACS,OAAL,IAAc,IAAjB,EAAsB;MACpB,KAAK7C,UAAL,CAAgBiB,MAAhB,GAAyB,IAAzB;IACD,CAXkB,CAanB;IACF;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;;IACA,IAAI6B,GAAG,GAAGV,IAAI,CAACW,SAAf,CAxBqB,CAyBrB;;IACA,IAAIC,eAAe,GAAG,kBAAkBF,GAAxC;IACAzD,EAAE,CAAC4D,MAAH,CAAUC,OAAV,CAAkBF,eAAlB,EAAkC3D,EAAE,CAACqB,WAArC,EAAiD,UAASyC,GAAT,EAAaC,WAAb,EAA0B;MACvE,IAAID,GAAJ,EAAS;QACL7B,OAAO,CAACC,GAAR,CAAY4B,GAAG,CAACE,OAAJ,IAAeF,GAA3B;QACA;MACH;;MACA,KAAKpD,SAAL,CAAeqD,WAAf,GAA6BA,WAA7B;IACA,CAN4C,CAM3C/B,IAN2C,CAMtC,IANsC,CAAjD,EA3BqB,CAmCrB;;IACA,KAAKH,IAAL,CAAUC,EAAV,CAAa,qBAAb,EAAmC,UAASC,KAAT,EAAe;MAC9CE,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAwCH,KAAxC;MACI,IAAIS,MAAM,GAAGT,KAAb;MACAE,OAAO,CAACC,GAAR,CAAY,sCAAoCM,MAAhD;;MACA,IAAGA,MAAM,IAAE,KAAKL,SAAhB,EAA0B;QACtB,KAAKxB,UAAL,CAAgBiB,MAAhB,GAAyB,IAAzB;MACH;IACJ,CAP8B,CAO7BI,IAP6B,CAOxB,IAPwB,CAAnC,EApCqB,CA6CjB;;IACA,KAAKH,IAAL,CAAUC,EAAV,CAAa,yBAAb,EAAuC,UAASC,KAAT,EAAe;MAClD,IAAIS,MAAM,GAAGT,KAAb;MACAE,OAAO,CAACC,GAAR,CAAY,0CAAwCM,MAApD;;MACA,IAAGA,MAAM,IAAE,KAAKL,SAAhB,EAA0B;QACxB,KAAKjB,gBAAL,CAAsBU,MAAtB,GAA6B,IAA7B,CADwB,CAExB;;QACA,KAAKT,UAAL,CAAgBgC,MAAhB,GAAuB,IAAvB,CAHwB,CAIxB;MAED;IACJ,CAVsC,CAUrCnB,IAVqC,CAUhC,IAVgC,CAAvC,EA9CiB,CAyDjB;;IACA,IAAGgB,KAAK,IAAE,CAAV,EAAY;MACV,KAAKlC,SAAL,CAAemD,CAAf,GAAmB,CAAC,KAAKnD,SAAL,CAAemD,CAAhB,GAAoB,EAAvC;IACD;EACJ,CAhKI;EAkKL;EACA1B,QAnKK,sBAmKK;IAEN,KAAKzB,SAAL,CAAec,MAAf,GAAwB,IAAxB;;IACA,KAAI,IAAIsC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,EAAd,EAAiBA,CAAC,EAAlB,EAAqB;MACjB,IAAIC,IAAI,GAAGnE,EAAE,CAACoE,WAAH,CAAe,KAAKrD,WAApB,CAAX;MACAoD,IAAI,CAACE,KAAL,GAAW,GAAX;MACApC,OAAO,CAACC,GAAR,CAAY,kCAAiC,KAAKpB,SAAL,CAAewD,MAAf,CAAsBA,MAAtB,CAA6BC,IAA1E;MACAJ,IAAI,CAACG,MAAL,GAAc,KAAKxD,SAAnB,CAJiB,CAKjB;;MACA,IAAI0D,MAAM,GAAGL,IAAI,CAACK,MAAlB;MACAL,IAAI,CAACM,CAAL,GAAS,CAAC,KAAK,CAAN,IAAW,GAAX,GAAiBD,MAAjB,GAA0B,GAA1B,GAAgC,GAAhC,GAAsCA,MAAM,GAAG,GAAT,GAAe,GAAf,GAAqBN,CAApE;MACAC,IAAI,CAACF,CAAL,GAAS,CAAT,CARiB,CAUjB;;MACA,KAAKX,aAAL,CAAmBoB,IAAnB,CAAwBP,IAAxB;IACH;EACJ;AAnLI,CAAT","sourceRoot":"/","sourcesContent":["import myglobal from \"../../mygolbal.js\"\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        account_label:cc.Label,\n        nickname_label:cc.Label,\n        room_touxiang:cc.Sprite,\n        globalcount_label:cc.Label,\n        headimage:cc.Sprite,\n        readyimage:cc.Node,\n        offlineimage:cc.Node,\n        card_node:cc.Node,\n        card_prefab:cc.Prefab,\n        //tips_label:cc.Label,\n        clockimage:cc.Node,\n        qiangdidzhu_node:cc.Node, //抢地主的父节点\n        time_label:cc.Label,\n        robimage_sp:cc.SpriteFrame,\n        robnoimage_sp:cc.SpriteFrame,\n        robIconSp: cc.Sprite,\n        robIcon_Sp:cc.Node,\n        robnoIcon_Sp:cc.Node,\n        masterIcon:cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n      this.readyimage.active = false\n      this.offlineimage.active = false\n      \n      //监听开始游戏事件(客户端发给客户端)\n      this.node.on(\"gamestart_event\",function(event){\n        this.readyimage.active = false\n      }.bind(this))\n\n      //给其他玩家发牌事件\n      this.node.on(\"push_card_event\",function(event){\n        console.log(\"on push_card_event\")\n        //自己不再发牌\n        if(this.accountid==myglobal.playerData.accountID){\n            return\n        }\n        this.pushCard()\n      }.bind(this))\n\n      this.node.on(\"playernode_rob_state_event\",function(event){\n          //{\"accountid\":\"2162866\",\"state\":1}\n          var detail = event\n      \n          //如果是自己在抢，需要隐藏qiangdidzhu_node节点\n          //this.accountid表示这个节点挂接的accountid\n          if(detail.accountid==this.accountid){\n            //console.log(\"detail.accountid\"+detail.accountid)\n            this.qiangdidzhu_node.active = false\n              \n          }\n\n          if(this.accountid == detail.accountid){\n            if(detail.state==qian_state.qian){\n             \n              console.log(\"this.robIcon_Sp.active = true\")\n              this.robIcon_Sp.active = true\n\n            }else if(detail.state==qian_state.buqiang){\n              this.robnoIcon_Sp.active = true\n             \n            }else{\n              console.log(\"get rob value :\"+detail.state)\n            }\n          }\n         \n      }.bind(this))\n\n      this.node.on(\"playernode_changemaster_event\",function(event){\n         var detail = event \n         this.robIcon_Sp.active = false\n         this.robnoIcon_Sp.active = false\n         if(detail==this.accountid){\n            this.masterIcon.active = true\n          }\n      }.bind(this))\n\n      // this.node.on(\"playernode_add_three_card\",function(event){\n      //   var detail = event //地主的accountid\n      //   if(detail==this.accountid){\n      //     //给地主发三张排\n\n      //   }\n      // }.bind(this))\n    },\n\n    start () {\n        \n    },\n\n    //这里初始化房间内位置节点信息(自己和其他玩家)\n    //data玩家节点数据\n    //index玩家在房间的位置索引\n    init_data(data,index){\n      console.log(\"init_data:\"+JSON.stringify(data))  \n      //data:{\"accountid\":\"2117836\",\"nick_name\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}\n      this.accountid = data.accountid\n      this.account_label.string = data.accountid\n      this.nickname_label.string = data.nick_name\n      this.globalcount_label.string = data.goldcount\n      this.cardlist_node = []\n      this.seat_index = index\n      if(data.isready==true){\n        this.readyimage.active = true\n      }\n\n      //网络图片加载\n    //     cc.loader.load({url: data.avatarUrl, type: 'jpg'},  (err, tex)=> {\n    //     //cc.log('Should load a texture from RESTful API by specify the type: ' + (tex instanceof cc.Texture2D));\n    //     let oldWidth = this.headImage.node.width;\n    //     //console.log('old withd' + oldWidth);\n    //     this.room_touxiang.spriteFrame = new cc.SpriteFrame(tex);\n    //     let newWidth = this.headImage.node.width;\n    //     //console.log('old withd' + newWidth);\n    //     this.headImage.node.scale = oldWidth / newWidth;\n    // });\n    //这里根据传入的avarter来获取本地图像\n    var str = data.avatarUrl\n    //console.log(str)\n    var head_image_path = \"UI/headimage/\" + str\n    cc.loader.loadRes(head_image_path,cc.SpriteFrame,function(err,spriteFrame) {\n        if (err) {\n            console.log(err.message || err);\n            return;\n        }          \n         this.headimage.spriteFrame = spriteFrame;        \n        }.bind(this));\n\n    //注册一个player_ready消息\n    this.node.on(\"player_ready_notify\",function(event){\n        console.log(\"player_ready_notify event\",event)\n            var detail = event\n            console.log(\"------player_ready_notify detail:\"+detail)\n            if(detail==this.accountid){\n                this.readyimage.active = true\n            }\n        }.bind(this))\n\n        //监听内部随可以抢地主消息,这个消息会发给每个playernode节点\n        this.node.on(\"playernode_canrob_event\",function(event){\n            var detail = event\n            console.log(\"------playernode_canrob_event detail:\"+detail)\n            if(detail==this.accountid){\n              this.qiangdidzhu_node.active=true\n              //this.tips_label.string =\"正在抢地主\" \n              this.time_label.string=\"10\"\n              //开启一个定时器\n\n            }\n        }.bind(this))\n        //?\n        if(index==1){\n          this.card_node.x = -this.card_node.x - 30\n        }\n    },\n\n    // update (dt) {},\n    pushCard(){\n        \n        this.card_node.active = true \n        for(var i=0;i<17;i++){\n            var card = cc.instantiate(this.card_prefab)\n            card.scale=0.6\n            console.log(\" this.card_node.parent.parent\"+ this.card_node.parent.parent.name)\n            card.parent = this.card_node\n            //card.parent = this.node\n            var height = card.height\n            card.y = (17 - 1) * 0.5 * height * 0.4 * 0.3 - height * 0.4 * 0.3 * i;\n            card.x = 0\n           \n            //console.log(\"call pushCard x:\"+card.x+\" y:\"+card.y)\n            this.cardlist_node.push(card)\n        }\n    },\n});\n"]}